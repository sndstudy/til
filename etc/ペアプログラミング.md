# ペアプログラミング

WEB+DB PRESS Vol.102 ペアプロ・モブプロ特集

## ペアプロのロール

- ドライバー
    - キーボードの前にいて、コーディングする人
- ナビゲータ
    - ドライバーの隣に座ってドライバーと話をしながら目標に導く人

## ペアプロ・モブプロの効果

- 作業への集中と質の向上
    - リアルタイムにコードのレビューを行っている
        - レビュー内容が反映されるのが即時なのでコードの質が上がる
    - 常に見られている緊張感
        - コードを綺麗に書こうと思う
        - コーディング規約が守られたコードになる
            - ナビゲータが規約を守られていない箇所を検知して教えることができる
    - 話すことによって考えていることが整理できる
        - 今何を考えているか相手に伝えることで考えが整理できる
        - もし間違った方向に進んでいる場合は教えることができる
    - コードの可読性や保守性の向上
        - 相手のコードやその説明に対して意図を確認する
            - 意図が分かりにくい場合は教えることで改善できる
            - 即時にフィードバックすることができるため吸収しやすい
    - 2人以上の目・脳を使う
        - 軽微なミスの防止
        - 設計の選択肢を広げることができる
- 知識と学びの共有
    - 技術力の底上げと高い教育効果
        - 新人は先輩のソフトの使い方やコードの組み方を学べる
    - 結果だけではなく過程から学ぶ
        - 従来のコードレビューは出来上がったコードに対して行っていた
        - ペアプロはコーディング最中にレビューができるため意図を確認することができる
        - プログラミングの大事な瞬間はコミットとコミットの間
    - コードの共同所有
        - 属人化を防ぐことができる
        - 自分のコードという責任を感じることができる
    - 暗黙知の共有
        - 言語化マニュアル化されていない知識やテクニックを共有することが容易

## なぜ今ペアプロ・モブプロなのか

- コードが事業そのものになった
    - ソフトウェアの成長スピードが事業の成長スピードを左右するようになった
        - 変化に対応できないソフトウェアは死んでしまう
        - 開発の質とスピードを両立し、価値を提供しつつ負債を積み重ねないようにする必要がある
- クラウドがインフラのコスト構造を変えた
    - ハードの初期投資を低減し、同時にセットアップやデプロイの自動化ができるようになった
    - クラウドとDevOpsによってサービスの仮設検証を低コストで開始、常時回せるようになった
- コードレビューを伴う新しい開発スタイルが現れた
    - GitHubの登場
        - GitHubフローなどのブランチ管理モデル
        - GitHub上でプルリクのレビューを通った機能が即時リリースされるモデル（継続的デリバリー）を採用する企業が増えた
- 環境の変化によって現れた新しい問題
    - GitHub時代の新たなボトルネック
        - プルリクのレビュー
        - プルリク差戻し
        - レビュー待ちのプルリク
    - ベテランはコードを書くのをやめてレビューに専念
        - 最も価値を提供できるベテランがコーディングできなくなる
    - レビュー速度をあげるために一つ一つのレビューに費やす時間を減らす
        - 広く深い指摘ができなくなる
    - ペアプロはリアルタイムでレビューをするため書き終わった後はすでにレビュー済みの状態となる
        - コードの完成から即リリースという態勢にできる

## ペアプロの進め方

- コードを書く前に方向付けを行う
    - 最終目標を決める
        - 2時間くらいで到達できそうな目標がよい
        - 隅々はまだ見えていないけどおぼろげに方向性が決まっている目標
    - 作業を書き出す
        - ToDoリストの作成
        - GitHubのマークダウン拡張記法でチェックボックス作成
        - イシューでも良いかも
        - ToDoの粒度が揃っていなくてもよいのでとりあえず書き出す
- コードを書きながら会話をし、考えを共有する
    - 考えていることを口に出す
        - 書こうと思っているコード
        - 設計について
    - よく聞いてドライバーを支える
        - typoやメソッドの間違った使い方など些細なミスをすぐ教えてあげる
        - ナビゲータは設計を共有できるように図を描いたりする
- ロールを交代する
    - 時間で交代
    - ステップで交代
        - プロダクトコードを書く
        - テストコードを書く
        - リファクタリングする
            - TDDと相性が良い
    - 自由に交代する
        - 言葉で指摘するよりコードを書いたほうが分かりやすい場合があるため
    - ドライバーはキーボードに正対する
    - 休憩をとる
- ペアプロと相性がよいTDD
    - 目標をテストコードで示せる
    - フェーズがあるので交代しやすい

## ペアプロをいつ行うか

- チームに新メンバーが入ってきたとき
- デバッグや不具合修正を行うとき
    - ナビゲータは引いた視点をキープしてドライバーが少しでもスムーズにデバッグできるようにサポートする
- 新機能を作成するとき
    - 開発のスループットを上げつつ、不具合の発生を予防
- 定期的にペアプロを行う
    - 日にまたは週に1回決まった時間に
    - 技術的負債の返済日に
- 作業タイプと作業時間で行うかどうか決める
    - 新規で作業時間が短い
        - ペア
    - 新規で作業時間が長い
        - ペア
    - 既存で作業時間が短い
        - ソロ
    - 既存で作業時間が長い
        - ペア・ソロどちらでも可

## 誰とペアを組むか

- ベテランと新人
    - 新人は業務知識からプログラミングテクニックを学べる
    - ベテランはアンラーニングのチャンス
        - 不要なもの時代遅れなものを切り捨てるチャンス
- ベテラン同士
    - 高度な設計を相談しながら高速に開発できる
- 新人同士
    - 経験が浅いペアの場合は立ち往生が多くなりスピードが遅くなる
    - 結局外部の人がコードレビューする必要が出てくる場合がある

## ペアプロの開発環境

- 開発環境をを統一する
    - IDEやマシンを統一させる硬派な解決策
- ハードウェアのばらつき対策
    - 大きいディスプレイを使用する
    - キーボードを2つ使う
- ソフトウェアのばらつき対策
    - 2つの環境を使い分ける
        - IDEを2つとも立ち上げておく
    - 第3の環境を使う
        - ペアを組む人どちらも使用したことのない環境で開発する
        - デフォルト主義
    - エディタやIDEの依存度を下げる
    - リアルタイム共同編集機能のある開発環境を使う
        - Cloud9
        - VS LiveShare
        - Teletype for Atom

## ペアプロは息苦しさを感じるので苦手

- パーソナルスペースを意識する
- ペアプロハラスメントに陥らない
    - ペアプロは強制してはいけない。人には向き不向きがある。
- 食わず嫌いの可能性があるので一度試してみてダメならやめる

## 個人の貢献がわかりにくい

- 人事評価がわかりにくい
    - チーム単位で評価する場合は問題ないが個人の評価が難しくなる
- ここは自分で書いたという実感がない

## ペア内にしか知識が残らない

- 意図を残すプログラミングを意識する
    - わかりやすい名前にする
    - 意図をコメントに残す
- ペアのローテーションで知識を共有する
