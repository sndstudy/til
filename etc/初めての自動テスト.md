# 初めての自動テスト

https://www.oreilly.co.jp/books/9784873118161/

## 3種類のテスト

- UIテスト
    - エンドツーエンドで動く
    - ユーザと同じ対象を見る
    - 高コストで遅い

- 統合テスト
    - WebサービスとAPIのテスト
    - つながりを見る
    - 詳細さに欠ける
        - どこが壊れているのか判断しづらい

- ユニットテスト
    - 高速
    - 多目的に利用できる
    - 統合部分の確認に弱い

## どのテストを優先すべきか

- UIよりもユニットテストを優先すること
- ユニットテストで埋められない部分を統合テストでカバーすること
- UIテストは限定的に使うこと
- 新しいテストを追加する場合は常にユニットテストでカバーできないか確認すること
- すべてを自動化しようと思わないこと。できる範囲で自動化すること。
    - テストの保守もあるので

## UIテストについて(Web)

- UIテストはエンドツーエンドのスモークテストとして有用
- 操作を記録するツールを用いて行うよりも手で書いたコードのほうが望ましい
    - 機械で記録するとコードが読めなかったりする
    - 少し変更を加えるだけで壊れやすい
- アサーションはHTMLタグを対象にする
- ページの要素を選択するにはCSSセレクタ
- 要素にIDをつけているほうが要素を取得しやすい
- アサーションは要素の存在（疎結合）で検証すること
    - 要素内の値で検証するとテストケースと検証する内容が密結合になってテストが壊れやすくなる

## テストの分離

- 1つの対象だけをテストする
    - クラスやメソッドを細かく分割する
    - 1つのクラスに詰め込みすぎない
- 1つのテストケースに対して1つのアサーションがベスト
    - 複数のアサーションが間違いではない
- テストのデータはできる限り使用するテストの近くにまとめる
    - すべてをsetup等のメソッドに書くのではなく、必要な箇所が1つだけの場合はそのテストケース内に書いたほうがわかりやすい

## コンテキストを明確にする

- UI
    - 画面、ユーザのワークフロー
- 統合
    - サービス、エンドポイント
- ユニットテスト
    - クラス、インターフェース

## TDDの利点

- オーバーエンジニアリングを防ぐ
    - TDDは最初に失敗するテストを書くまではプロダクトコードを追加できない
    - 過剰なつくり込みを防ぐ効果がある
    - XPのYAGNIという原則
- コードの設計が改善され、しっかりとテストされたコードになりやすい
    - 最初から設計とテストを考えることになるので保守しやすいシンプルなコードになりやすい
- 複雑な内容を扱いやすい
    - 1つのテストケースを通すことに注力できる
    - 他のことを気にしながら実装するという不安とストレスから避けることができる
- 単純に楽しい
    - テストの成功を積み重ねて実装をしていく
    - 少しずつ前進することができるので小さな満足感を感じることができる

## 実際にテストコードを書いてみる

- 失敗するテストを書く時点で既に設計が始まっている
    - 責務
        - メソッドをどこに定義するのか
    - 命名
        - そのメソッドを何と呼ぶか
    - 入力の変数
        - 入力として何を渡すのか
    - 出力される値
        - 何を返せばよいか
    - 可視性
        - そのメソッドはプライベートかパブリックか
- プロダクトコードが既に存在していると仮定する

