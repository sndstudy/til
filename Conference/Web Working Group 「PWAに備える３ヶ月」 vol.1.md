# Web Working Group 「PWAに備える３ヶ月」 vol.1

## 「Progressive Web Apps: WebのInstallabilityのおさらい」

- Webに足りなかったもの
    - push通知
    - ホーム画面にアイコン設置
- PWAはホームに追加できる
    - アイコンが追加できる
    - Playストアを経由しないでインストール
    - GoogleMapやTwitterLiteもPWA化している
- どうやっていホームに追加できるの?（条件）
    - Chrome は、アプリが次の条件を満たすと、自動的にバナーを表示します
        - https://developers.google.com/web/fundamentals/app-install-banners/
        - ウェブアプリ マニフェスト ファイルが存在する。
            - short_name（ホーム画面で使用）
            - name（バナーで使用）
            - 192x192 の png アイコン（アイコンの宣言には MIME タイプ image/png の指定が必要）
            - 読み込み先の start_url
        - サイトに Service Worker が登録されている
        - HTTPS 経由で配信されている（Service Worker を使用するための要件）
        - 2 回以上のアクセスがあり、そのアクセスに 5 分以上の間隔がある
            - Chromiumのソースを見ればわかる
    - 上記の条件はあまり更新されていないので逐一最新情報を確認する必要がある
    - バナーの表示を制御するために`beforeinstallprompt`イベントで制御する
- ホーム追加後はアプリとして認識される
    - 他人にリンクをメールなどで送ってもその人がインストール済みであればアプリを開く
    - 別タブでブラウザが開かれない
- オフライン時でも信頼性のある体験
    - Service Workerのキャッシュによって実現
    - オフラインなので時間を置いてページを開いてください的なメッセージはマナーとして出していきたい
- Lighthouseでパフォーマンス分析をしよう
    - ChromeのDevToolですぐに使える
        - Auditsを選択する
    - PWA具合とか確認できる
    - パフォーマンスを気にするなら使うべきツール
- Chrome Custom Tabs
- その他
    - Web Share Target API
        - 他のSNSアプリとの連携
    - New Image upload UI
        - 画像がグリッドで表示される
    - Trusted Web Activity
        - PWAをアプリに組み込む
        - WebViewとは異なる（Service Workerが使えるようになる）
- 今後
    - iOS 11.3でPWAのコア機能がローンチ
    - MS StoreにPWA
        - デスクトップPWA
    - Service Workerを簡単に使いたい
        - Workboxというラッパーされたライブラリがある
    - Credential ManagementAPI
        - ブラウザに保存した認証情報をJSでアクセスして裏でオートログインする
    - Payment Request API
        - 支払い入力フォームをブラウザが提供してタップのみで購入完了
        - 様々なサイトでフォームが異なるため、いちいち情報を入力する手間をなくす
- 結局PWAって?
    - 新たなUXの基準
        - プッシュ通知
        - ホーム画面に追加
        - 簡単な支払い
        - 信頼の置けるパフォーマンス
        - 常にログオン

## 「Service Worker とは何者か」

- コンテンツマイニング
    - 既存コンテンツの見直し
    - 埋もれた魅力的なコンテンツの発掘
- PWA化
    - HTTPSサイトであれば可能
- PWAやってみた
    - WordpressとWooCommereceで構築されたサイトをPWA化
    - WordpressでPWA化できるプラグインも登場している?
        - 「SUPER PWA」というプラグインを使ってみた
    - スプラッシュが良い
    - キャッシュが効いていて速い
- PWA化された中身を見てみた
    - manifest
        - アプリの基本情報が記載されている
    - イベントリスナ
        - install
            - インストール時のアクション
            - インストールが終わったら、まずは必須なところをキャッシュする
                - アイコン・スタートページなど
        - activate
            - インストール後の状態
            - 古いキャッシュを削除したりする
        - fetch
            - URLリクエストが発生した時のイベント
- Service Workerって何者
    - キャッシュを制御するもの
- Service Workerのライフサイクル
    - https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle?hl=ja
- キャッシュを除外したい
    - 決済ページ等はキャッシュNG
    - プラグインをそのまま使うと除外できないため、コードを追記した
- 所感
    - PWA化するだけなら簡単
    - プラグインを入れたとしても、少しカスタマイズするだけで使える
    - 速い、それだけでも価値がある
    - ゼロから新しいものを一気に作り上げるのもいいけど、既存サイトをPWA化して少しずつリッチにしていくアプローチの方がいいかも
        - コストがかかりにくい
    - 未対応の環境には影響なし

## 「PWAってどんな使い方ができるのかしら？」

- PWAが対応しているAppって増えてきている
    - 特に海外
- PWA化してみた
    - HTTPS
        - 慣れていないので面倒
    - Service Worker
        - ホーム追加だけなら何もしない
    - ホームアイコン
        - 作るのが面倒だった
    - スプラッシュ
- PWA対応の狙い
    - リピーター施策を取りやすいため
        - push通知で新しいイベントやコンテンツの案内
        - ユーザがコンテンツにたどり着きやすくしたい
- 気になる記事
    - https://anond.hatelabo.jp/20180321171652
    - 何でもかんでもPWA?
- アプリ開発の選択肢
    - ユーザ操作性
        - ネイティブが優位
    - ユーザへの配布
        - WebAppが優位
- PWA採用のポイント
    - ユーザへの配布を強化したい
    - ネイティブアプリの必要性が弱い
        - ネイティブの開発コストに合わない
        - 操作性があまり変わらない
    - 単なるWebAppより体験を向上させる必要がある
        - ユーザの再訪問
- こういったものに使えるのでは
    - コミュニティのフォーラム
    - イベント案内のアプリ
        - タイムテーブルなど何度も使うページ
    - スタッフが利用するインナーアプリ
        - 営業ツールやアンケートアプリなど
    - 定期的に更新され、ユーザも定期的に閲覧するアプリ
- こういう状況が起きる?
    - 品質の低いPWAが頻発する?
        - 検索エンジンの評価が下がる
- まとめ
    - HTTPS対応しよう
    - PWAに向き不向きのコンテンツがあるはず
    - ちゃんとした設計思想にしないとゴミアプリになる
    - ゴミPWAが検索順位に嫌われる
    - サービスのステータスをみて、ネイティブ・PWAを選択しよう
    - UXのデザインがより一層を重要になっている

## フリートーク

- Q.フォールバックを実装するのはマナーと言っていたがマナーとは具体的に何を指すのか
    - A.ユーザにとって良いものをマナーという表現で言っている。ユーザが使いやすいAppが良いので
- Q.重いファイル等もキャッシュができるのか
    - A.キャッシュすることは可能。しかし、果てしなくキャッシュするとユーザが怒る
    - A.ユーザが求めているものをキャッシュすべき
- Q.キャッシュのリミット
    - A.一見で訪れたサイトは空いているストレージの6%がリミット。インストールしたものはリミット無しでキャッシュできる
- Q.一つのアプリに対して飛ばせるページを変えることができるのか
    - A.スコープで制御すれば可能。ちなみに一番範囲が広いスコープはルート
- Q.PWAとネイティブの違いは審査の有無だと考えていて、モラルハザードが起きるのでは
    - A.起きると思う。その分、検索順位が下がると思う
- Q.PWAの仕様を追う時にどこを見れば良いか
    - A.W3CのサイトやChromiumの更新情報など
- Q.ChromeはPWAに前向き、iOSはそこまで前向きに見えないがどう思う?
    - A.それぞれで標準化を行なっているだけで嫌っている訳ではないと思う。Chromeがアグレッシブすぎるのかも。
- Q.ブラウザ差異、OS差異などの環境差異とその対応
    - A.新しいAPIが使えるところはどんどん使っていこう。ロジックで使う、使わないは制御できる
    - A.Polyfillの有無を確認した方が良い
        - https://developer.mozilla.org/ja/docs/Glossary/Polyfill
- Q.社内だけPWAのセキュリティ
    - A.キャッシュ周りを気にすること。通常のWebAppと変わらない感じで良いと思う。キャッシュするものを選定する

## 宣伝

- 6/9にABC Spring2018でPWAトラック決定