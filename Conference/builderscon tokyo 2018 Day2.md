# builderscon tokyo 2018 Day2

- https://builderscon.io/tokyo/2018
- 開催日
    - 9/8(土))
- 会場
    - 協生館（慶応大学）
- イベント内容
    - buildersconは、「知らなかった、を聞く」をテーマとした技術を愛する全てのギーク達のお祭りです
  
 ## 「Web とは何か？」 - あるいは「Web を Web たらしめるものは何か？」

 - 進化と変化
    - 新しいAPIが定義されてできることが増えた
    - Appとの距離がどんどん縮まる
    - WebがWebであり続けるために重要なのは何か
- Webに関わる視点
    - Webを使う人たち
    - Webで作る人たち
    - Webを作る人たち
- HyperMediaSystemにとって重要なこと
    - セマンティクス
    - URLによるアドレス可視性
    - 分散システム
- 既存モデルの限界
    - ブラウザが取得したJSを即座に実行する
    - JSがページの表示後にリクエスト投げる
    - サーバはそんなリクエストが飛んでくるとは思っていない
    - Cookieや認証で守られたリソースが奪える
        - どうやって守るか?
        - Ajaxを諦める?
        - ここを失敗したまま進むとWebは壊れる
- Originの導入（SameOriginPolicy）
    - Webのでキュリティモデルを整備
        - XHRやiframeの挙動原理の整理
        - Ajaxの正当化
        - Appを作る上で避けて通れない
    - 派生議論を説明する起点に
        - JSONPなどの問題点
        - 今後策定されるAPIの基本設計
        - Originを超えてしまうバグのヤバさ
    - Originを定義したことで様々なセキュリティの議論の起点となった
- CrossOrigin
    - Originを正しく越えるための手順
        - CORS
            - Preflight
        - WebSocket
            - Handshake
        - WebRTC
            - Signaling
        - ServiceWorker
            - OpaqueResponse
    - CORSが破られることの重大性
        - CROSSOriginInfoleaksの対策
        - SiteIsolation
        - 高額報奨金
    - Cookieがやばい
        - Originの上で焼き直し中
- Appを作るには貧弱すぎた
    - ないものが多い
        - 線すら引けない
        - 動画や音声も再生できない
        - 好きなFontが選べない など
- ApplicationPlatformとしての側面が強くなるにつれてContentsUseCaseでWebを規定できなくなり始めている
- デバイスにアクセスするAPIが増えてきている
    - WebのOS化
- OSのセキュリティモデル
    - 基本はインストールというモデルに絡める
    - Webにはそれがない
        - かといって取得し実行したJSが無尽蔵に触られても困る
- Permissionモデル
    - PermissonAPI
    - Quota
    - FeaturePolicy
    - SecureContextRestriction
    - UserGestureRestriction
    - budgetAPI(rejected)
- Permissionモデルについては絶賛議論中
- WebがApplicationPlatoform、そしてOSへと進化している
    - しかしOS化はPermissionの問題がある
        - これからのWebの形が決まってくる
- Idea of Web
    - その時の時代の要求に応じて変化する
    - WebがWebとして壊れないために必要なものを模索
    - 今はWebにとって重要な過渡期

 ## 証券トレーディング業務におけるExcel依存を脱却するプロジェクトで直面した技術的選択とプロジェクト運営の失敗

- 結論 
    - Excel辛い
    - Excel脱却も辛い
- なんで失敗の話?
    - 失敗から学べることもあるはず
- 証券トレーディング業務とExcelの話
    - 現実
        - 大手証券会社の取引の大部分は伝統的なビジネス
        - 伝統的なビジネスにはすでに出来上がったExcel依存の業務フローがありがち
- 自動化と手入力
    - 自動化
        - トレーディングシステム以降
    - 手入力
        - トレーディングシステムに入力するデータ
- Excelでの提示価格の決め方
    - トレーダーが定義したExcel数式
    - こだわりがあるトレーダーならVBAで組んでいる
    - 問題
        - 数式が複雑がしがち
        - 当該トレーダーの退職・異動後はメンテ地獄
- Excelトレーディングを続ける理由
    - トレーダー同士は同じ会社内でもライバル
    - コンプライアンスの面
    - IT部門が作ったシステムだと中身(数式)が見えなくなりトレーダーが嫌がる
        - IT部門に問い合わせをすると返答に何日かかるかわからない
    - 属人性の高い業務
    - ファイルフォーマットが会社によってゆるふわ
- 開発体制
    - 開発担当者は4人
        - 通常は1人のため異例(それぐらい重要顧客)
- IT部門上層部からの横槍
    - 貴族階級みたいなものなので絶対に逆らえない
    - 内容
        - Excelは完全に排除しろ
        - 4ヶ月以内に本番環境へ
        - 指定された社内FWの使用
            - 開発メンバーは誰も触ったことがない
        - 明らかに無理なことを言っている
            - もちろん失敗した
- 何が起きたか
    - 社内FWを使った結果
        - Excelとキーボードショットカット違うんだけど
        - 数式機能が使えないんだけど
        - Excelよりも使えない何かがデプロイされただけ
            - Googleのスプレッドシート並みの機能を求められても無理
    - 海外の社内トレーダーから苦情
        - こんな使いづらいものを使わない
        - テストに非協力的
    - 日本のビジネス部門利害調整してくれなかった
        - 英語ができないため
    - 一部の方しか利用しなくなった
        - 旧手順と新手順が混合してしまったためミスが頻発
        - 営業担当3人がクビに。しかし、IT部門はお咎めなし。
            - 自分が作ったシステムで他人を死なせてしまった。逆に胃が痛い
- 開発体制の問題
    - 社内FW、海外で開発されたものなのでチーム内に知見がなかった
        - 逐一電話で聞く羽目に
    - 社内FWに要件を満たす必要最低限の機能が備わってなかった
        - 明らかに技術選択のミス
- 振り返り
    - 証券会社とExcelの深いつながり
    - Excelで作ったシステムのメンテナンスは辛い。しかしそこから抜け出すのも辛い
- アンチパターン
    - 上から降ってくる技術選択、それも大きい選択
    - 政治力が及ばない相手との共同作業
    - 短すぎる納期と低すぎるエラー発生率目標
    - 既存ワークフローのいいところを無視
    - 後から明らかになる要求に対応できない開発体制
- QA
    - Q.どういうタイミングで転職を決意したか。どこまで我慢していたか
        - A.このプロジェクトが始まる前から考えていた。そもそも証券の業界は人材の流動性がある
        - A.保守がどんどん辛くなっていき、心が病んでしまったのもあった

## 業務時間で書いたパッチは誰のもの？ OSS 活動にまつわる罠

- OSSの原則
    - 問題があれば自己解決
    - 不具合があれば自分たちて直す
- OSSに不具合があったらパッチを書く
    - 本家にマージしてもらう
    - 再度パッチを当てる必要がなくなる
- パッチの行方
    - このパッチは社外公開していいの?
    - 誰に許可を取っていいの?
    - 何名義で公開すればいいの?
    - CLAへの署名を求められた
- 趣味OSS
    - 誰かに使われると嬉しい
    - 自チームの業務に採用される→超嬉しい
    - 業務時間で使っている趣味OSS
        - 業務時間に趣味OSSのパッチ作成に使っていいの?
        - 会社のコードは混ぜたくない
        - パッチの著者は誰になる
- サイボウズではOSSポリシーを設定している
    - ポリシー
        - 全体的な方針やルール
        - どの会社でも適用できそうな汎用的な書き方
    - ガイドライン
        - 細則、具体的な内容
- ポリシー策定前の状況
    - OSSの利用前にライセンスを確認する
    - OSSのパッチを当てる前に所属部長に許可を得る
- 著作権の帰属
    - 会社に帰属する場合
        - 当社の極秘情報を含むもの
        - 上長の明示的指示または承認をもとに作成されたもの
    - その他は社員個人のものとなる
        - .vimrc
        - 自発的に書いたOSSパッチなど
- CLA同意を求められた場合
    - 当社を代表して署名して良い
- OSS推進室について
    - 2018年8月に設立
    - ポリシーとガイドラインのメンテ
    - 社外のOSSコミュニティの支援

 ## RDB THE Right Way ~壮大なるRDBリファクタリング物語~

 - スライド
    - https://speakerdeck.com/soudai/rdb-the-right-way

##  Lightning Talks

### キーボードをカスタムしてプログラミング環境をよくした話

- エリクサーのパイプ演算子
    - |>
    - キーボードで打ちにくい
- ファームウェアを書き込めるキーボードが必要
    - キーボードを自作する
    - QMK
        - https://github.com/qmk/qmk_firmware
    - パイプ演算子を打ちやすくするマクロを作成

### WebReplay

- https://developer.mozilla.org/en-US/docs/Mozilla/Projects/WebReplay
- クライアントサイドのバグ再現のために使用できるかも

### チームでテストを書くために

- 過去
    - テストがない
    - 効果がわからない
    - 経験知識がない
- 経験を積むために必要なこと
    - 先導する
        - 書けるように導く
        - 一人で書き始める
        - テスト環境を整備する
    - 敷居を下げる
        - カバレッジ100%を目指さない
    - 効果を実感する
        - リファクタリングがしやすい
        - ライブラリのバージョンがあげやすい
        - テスタブルなコード
- 現在
    - チーム全員がテストを書く
    - メンバーからテストツールの変更提案が出て来た
- とにかく書いてみる
- 小さく始めてみる
- 簡単なことから始めてみる

### cpanfile

- https://www.slideshare.net/takafumionaka/cpanfileruby



