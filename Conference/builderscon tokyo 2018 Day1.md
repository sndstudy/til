# builderscon tokyo 2018 Day1

- https://builderscon.io/tokyo/2018
- 開催日
    - 9/7(金)
- 会場
    - 協生館（慶応大学）
- イベント内容
    - buildersconは、「知らなかった、を聞く」をテーマとした技術を愛する全てのギーク達のお祭りです
  
## Electronによるアプリケーション開発事情2018

- スライド
    - https://speakerdeck.com/h3poteto/builderscon2018
- Electron
    - Chromium + Node.js
    - クロスプラットフォーム対応のアプリが開発可能
    - React,Vue.jsも使える
    - vue-cliで雛形が作れる
        - auto-reload
        - テストの雛形を作ってくれる
- Electron基本構造
    - プロセス間通信が可能
- 嬉しいこと
    - React,VueをGUIアプリケーションで開発可能
        - iOSで開発していた頃はViewControllerが無限に太る。見通しのよいコードが書けない
    - クロスプラットフォーム
        - 同じソースのままビルド可能
        - 一部Mac向けの機能も実装されている
    - Electronのリリースが活発
        - ベースがChromiumのためChromiumのバージョンを更新するためのリリースが多い
- 開発系の記事は多いがリリースに関する記事は少ない印象
- リリースについてはelectron-builderがあれば大体解決する
    - 公式ドキュメントが豊富
    - ビルド設定がpackage.jsonに書ける
    - 各種インストール可能なファイル形式に圧縮(exeなど)
- Mastodonクライアントをクライアントを作る
    - Mastodonのデスクトップ向けのクライアントが少ない
        - ないので作ってみた
    - 作成したアプリのコンセプト
        - Linuxで使えるもの
        - Slackライクな見た目
        - ショートカットはとにかく多く(マウス操作したくない)
    - 海外からの反応
        - アプリ自体の評判はいいが、Electron使っている点については評判が悪い
        - 理由
            - メモリ消費が多い
            - Node.jsが嫌い
    - メモリと戦う
        - Streamingによるメモリ消費
            - 特に消費が増えなかった
        - レンダリングが原因か?
            - 全てのツイートをレンダリングしているため消費が増えている
            - 画面に表示しきれないツイートもレンダリングしてしまっていた(スクロールが永遠に伸びる)
        - タイムラインで全て表示するのをやめる
            - 最新40件のみ表示するようにした
            - 200MBのメモリ消費量削減
        - ベースとなるElectronのバージョンを上げることでメモリ消費量が少なくなる
            - パフォーマンスはChromiumに合わせてどんどんよくなる
- QA
    - Q.Mastodonの本家はReactで作成されている。参考にした点はあるか?
        - A.参考にした点はリプライを飛ばす時のユーザサジェスト機能
    - Q.OS固有のバグとかあるのか?
        - A.ある。ArchLinuxで動作させた時にElectronがクラッシュする。現在は誰かがイシューを立てて解決済み
    - Q.Electronはリリースが頻繁にあるがバージョンを更新した際に壊れたことがあるか?
        - A.登壇者自身はない
    - Q.mainとrendererプロセスの使い分け
        - A.ツイートの取得はmain、描画はrenderer。Node.jsのライブラリを使用する場合はmain(ブラウザでは使用できないため)
        - A.認証情報系はmain。mainプロセスからしか見れないようにセキュリティの観点で配慮している
    - Q.NW.jsとElectronがあるがElectronを選択した理由
        - A.Electronの方が成熟していた
    - Q.開発時のビルド時間はどれくらいか
        - A.20秒くらい。スペックが低いPCでも1分ぐらい
    - Q.Electronの自動更新機能は付与しているか
        - A.付与していない。AppleStoreの審査でリジェクトされるため

## 開発現場で役立たせるための設計原則とパターン

- 設計とかパターン
    - 議論が空中戦になりがち
        - ビジネスロジックって具体的にどんなこと
        - 抽象化ってなんだ
        - 責務とか考え方次第じゃない?
- そもそも設計とは
    - ある問題に対して解決策となるような構造を与えるアクティビティ
    - 問題を分割し、構造化する
        - 闇雲に分割していいの？
        - デザインパターンを適用すれば設計なの?
    - どう分割するか
        - どういう目線で分割する?
    - 複数の分割構造の選択肢から問題に対して最適な選択肢を選ぶことが設計
    - デザインパターン
        - 分割構造と実現方法のカタログ
    - 設計原則
        - 分割構造がよい構造か判断をするルール
    - 構造を一旦作成して設計原則に則っているか確認をする必要がある
- 実例で見てみる
    - サービスとして掲示板がある
        - マイページのお知らせに通知が出る
        - お知らせには掲示板の新しい書き込み以外のの通知も出る
        - push通知を設定しているユーザはpushでも通知する
    - チームの底力を上げるためにも設計レビューなどで言語化する必要がある
        - 設計原則に照らし合わせることで言語化できる
- 設計原則(重要なもの)
    - 単一責任原則
        - あるクラスを変更する理由が二つ以上あってはいけない
        - １つのモジュールには1つの責務
    - 解放閉鎖原則
        - 拡張に対して開いている
            - 機能追加する際に他のクラスに影響がないようにする
        - 修正に対して閉じている
            - 内部を修正した際にそのクラスに依存しているクラスに影響がないようにしなければならない
            - 使う側にまで修正が及ばないこと
    - 凝集度と結合度
        - 凝集度は高く
            - 関連するものは一つにまとめる
            - 一個の仕様変更で色んなクラスに影響が出るのは低い証拠
        - 結合度は低く
            - 片方の変更がもう片方に影響を及ぼさない状態
        - 結合度が高い＝修正に対して閉じていない状態
        - 凝集度が低い=拡張に対して開いていない状態
- Observerパターンについて
    - 設計原則に則って確認した結果、凝集度と結合度で問題があることがわかった
        - 再設計する
- パターンなどを利用しつつ分割構造を考える
- 設計原則に照らし合わせてこれでいいか考える
    - 上記2つを繰り返して設計をする
- 設計原則を使って構造の吟味をする際にまずは「どこが変わりやすいポイントなのか」を見極める必要がある
- KISS原則
- YAGNI原則
    - 「どこが変わるかわからない」時には元座わかっている範囲のみで極力シンプルにしておくべき
- FizzBuzzEnterpriseEdition
    - https://github.com/EnterpriseQualityCoding/FizzBuzzEnterpriseEdition
    - FizzBuzzを色んなパターンで書いてある

## Webサービスにて200週連続で新機能をリリースする舞台裏

- スライド
    - https://speakerdeck.com/daiksy/builderscon-tokyo-2018
- Mackerel
    - サーバ監視ツール(Saas)
- 連続リリース
    - バグフィックスやメンテナンスリリースは含めない
    - ユーザにとって価値のある機能を毎週必ずリリース
        - 年末年始、ゴールデンウィーク、お盆期間は除く(ホワイト企業なので)
- なんのために連続リリースをしているか
    - Mackerelはとてもミニマムな状態からスタートした
        - 今では当たり前の昨日のほとんどは未実装の状態でスタート
    - 開発のスピード感が顧客に対しての価値であり優位性だった
        - 毎週リリースをアピールしたところ顧客拡大の大きな武器となった
- 200週を区切りに連続リリースをやめる
    - 主要な機能が出揃った
    - スピード感も大切だが腰を据えた昨日開発の方が顧客にとって大きな価値をできると判断した
        - スタートアップ期の終了
- QA
    - Q.開発チームはPOからどのように信頼を得ているのか
        - A.元々はエンジニアの方のためそこまで信頼を得るのに苦労はしていない
        - A.お互いの信頼関係は築けていると思う

## イノベーションを止めずに、端末管理と運用を行う方法

- 端末管理の目的
    - ライセンス管理
    - 情報セキュリティ対策
    - 不正利用対策
    - コスト削減につながる端末の稼働状況の確認
- 念頭におくこと
    - 管理の目的を見失わないこと
    - 性善説は成り立たない
- 端末管理の方針
    - 懸念における対応が未定義・未確定であればきつめに設定
        - 要望が実現できないものもある
            - 代替案を考える
        - 端末は無くしてしまう前提
- macOS 使用用途
    - ソフトウェア開発
    - 本番データへのアクセス
    - 管理ツール
        - プロファイルマネージャー

## JavaCardの世界

- スライド
    - https://speakerdeck.com/moznion/the-world-of-java-card

- 身近なJavaCard
    - クレジットカード
    - SIMカード
    - などなど
- SmartCard
    - ISO 7816で定義されている
- SmartCardMemory
    - ROM
    - EPROM
    - RAM
        - ３つのメモリがある
- SmartCardIF
    - APDUというプロトコルで外部とデータをやり取りする
- UICC(Universal Integrated Circuit Card)
    - ある程度の演算処理が可能
    - JavaCard(3.0.1以降)の実行基盤
- JCRE
    - UICC上で動くJavaのランタイム
    - 機能が制限されている
        - 大きいプリミティブタイプは使えない
            - doubleやfloatなど
- メモリライフサイクル
    - GCがあるかどうかはカードの機能次第
- メモリ
    - インスタンス変数はEEPROMに書き込まれる
    - インスタンス変数に書き込みまくるとカードが壊れる
    - RAMはあるけど小さい
        - 一時的なデータや認証情報で使用
- JVMライフサイクル
    - シャットダウンの概念がない
    - 電源供給がない場合は無限のクロックサイクルとみなしている
- Applet
    - JavaAppletではない
    - JavaCardRuntimeで動かすアプリケーションの単位
- 開発について
    - intが使えるのは限定的な状況のみ
    - 特殊な状況がない限りshortを使う
    - floatやdoubleは使えない
    - Stringも使えない
        - byte配列で文字列を保持する
- ツール
    - Eclipse
        - 唯一JavaCardプラグインがある
    - JDK
        - 1.6(一番安定している)
    - JCDK
        - JavaCardのバージョンに合わせる
- JavaCardってどこで買えるの
    - Amazonで買える
- QA
    - Q.JavaCardでforループって使える?
        - A.使用可能
    - Q.配列のインデックスの型はint?
        - A.言語仕様になるかもしれないけどshortを使う方が無難
    - Q.JavaCardが壊れた場合、修復する方法があるか?
        - A.EEPROMが壊れてしまっているので修復不可能。交換になってしまう
    - Q.数値リテラルを書くと型はどうなるか
        - A.デフォルトはintになるのでJavaCardではエラーになる
    - Q.JavaCardが実勢どのようなアプリケーションで使われているか
        - A.SIMカード。特に認証系のアプリを実装することが多い
    - Q.開発時に使用するエミュレータはあるのか
        - A.エミュレータはある。商用のアプリケーションになる
    - Q.GitHub上でJavaCardのソースコードをどう判別したらよいか
        - A.javacard.frameworkで検索すれば引っかかる
    - Q.JavaCardの今後の流行り廃り
        - A.SmartCardの仕様に則ってるのがJavaCardぐらいしかないので今後10年でスマホやクレジットカードが廃れることが無ければ食べていける

## lld − 開発ツールの主要コンポーネントの1つをスクラッチから作成した話

- lldとは
    - LLVMのサブプロジェクト
    - ELF,COFF,Mach-O,WebAssemblyをサポート
    - とにかく高速
- 採用事例
    - FreeBSDの時期バージョンの`/usr/bin/ld`はlld
    - Chrome(Windows,Linux,Android)
    - Firefox(Windows)
    - Rust
    - そのほか多数
- リンカとは
    - オブジェクトファイルを1つの実行ファイルやDLLにまとめるプログラム
- コード規模
    - lld/ELF 2.9万行
    - gold 20万行
- 速くてシンプルなコードを書くために
    - よいデータ構造にするのが重要
        - データが先
        - コードは後
    - 最適化する箇所を最小に留める
        - 大半のコードは読みやすさを重視して書く
    - プロジェクトのオーナーが責任を持ってコードを綺麗に保つ
